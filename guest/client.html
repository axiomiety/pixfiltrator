<html>
  <head>
    <link rel="stylesheet" type="text/css" href="client.css">
  </head>
  <div id="container">
    <div id="left">
      <input type="file" id="fileElem" accept="image/*" style="display:none" onchange="handleFiles(this.files)">
      <a href="#" id="fileSelect">Select a file</a>
      <button type="button" id="nextBtn" onclick="prev()">&lt;</button> 
      <button type="button" id="nextBtn" onclick="play()">Play</button> 
      <button type="button" id="nextBtn" onclick="next()">&gt;</button> 
      <div id="pageTracker">?/?</div>
      <div id="fileList">
        <p>No files selected!</p>
      </div>
    </div>
    <div id="right">
      <canvas id="myCanvas" width="1200" height="800"></canvas>
    </div>

<script type="text/javascript" src="lib.js"></script>
<script>

var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");
const sqWidth = 5;

function play() {
    setTimeout(draw, 3*1000, ctx, offset, hexArray, numSquaresPerPage, numPages, true);
}

clearCanvas(ctx);
window.URL = window.URL || window.webkitURL;

const fileSelect = document.getElementById("fileSelect"),
    fileElem = document.getElementById("fileElem"),
    fileList = document.getElementById("fileList");

fileSelect.addEventListener("click", function (e) {
  if (fileElem) {
    fileElem.click();
  }
  e.preventDefault(); // prevent navigation to "#"
}, false);

let hexArray = [];
let offset = 0;
let numPages = 0;
let numSquaresPerPage = 0;

function next(playNext) {
  if (offset < numPages-1) {
    offset += 1;
    updateNumPages();
    draw(ctx, offset, hexArray, numSquaresPerPage, numPages, playNext);
  }
}

function prev() {
  if (offset > 0) {
    offset -= 1;
    updateNumPages();
    draw(ctx, offset, hexArray, numSquaresPerPage, numPages, false);
  }
}

function foo(file) {
  const fr = new FileReader();
  fr.onload = () => {
    const data = fr.result;
    let array = new Uint8Array(data);
    console.log(`length of data: ${array.length}`);
    digestMessage('SHA-256', array).then(h => console.log(`SHA256: ${h}`));
    for(let i=0; i<array.length; i++) {
      // TODO: change this to .padStart(2,'0');
      const hex = array[i].toString(16).padStart(2, '0');
      hexArray.push(hex[0]);
      hexArray.push(hex[1]);
    }
    numSquaresPerPage = getNumSquaresPerPage(ctx, sqWidth, true);
    numPages = calcNumPages(hexArray.length, numSquaresPerPage);
    draw(ctx, offset, hexArray, numSquaresPerPage, numPages);
    updateNumPages();
  }
  fr.readAsArrayBuffer(file);
};
</script>

</html>